// SPDX-License-Identifier: MIT
// Copyright (c) 2025 Joris Gillis, YACODA

//! base 0.1.0
package 'AlgorithmForLoopNested'
  // Function with nested for loops for matrix operations
  pure function 'matrixScale' "Scale a 2x3 matrix element by element"
    input Real 'mat'[2, 3];
    input Real 'factor';
    output Real 'result'[2, 3];
  algorithm
    for i in 1:2 loop
      for j in 1:3 loop
        'result'[i, j] := 'factor' * 'mat'[i, j];
      end for;
    end for;
  end 'matrixScale';

  model 'AlgorithmForLoopNested' "Model using function with nested for loops"
    parameter Real 'A'[2, 3] = {{1.0, 2.0, 3.0}, {4.0, 5.0, 6.0}};
    parameter Real 'k' = 2.0;
    Real 'x'(start = 0.0);
    Real 'B'[2, 3];
  equation
    der('x') = 0.1;
    'B' = 'matrixScale'('A', 'k');
  end 'AlgorithmForLoopNested';
end 'AlgorithmForLoopNested';

// @onnx-test-reference
// Python reference implementation for ONNX runtime testing
// def reference_implementation(inputs):
//     import numpy as np
//     outputs = {}
//
//     # Extract inputs
//     x = inputs['x']
//     der_x = inputs["der(x)"]
//     B = inputs['B']
//     A = inputs['A']
//     k = inputs['k']
//
//     # Equation 0: der(x) = 0.1
//     outputs['eq[0]'] = der_x - 0.1
//
//     # Equation 1: B = matrixScale(A, k)
//     # The function scales each element: result[i,j] = factor * mat[i,j]
//     scaled = np.zeros((2, 3))
//     for i in range(2):
//         for j in range(3):
//             scaled[i, j] = k * A[i, j]
//     outputs['eq[1]'] = B - scaled
//
//     # Initial value
//     outputs['start[0]'] = np.array(0.0)
//
//     return outputs
//
// @onnx-test-case
// # Test case 1: A = [[1,2,3],[4,5,6]], k = 2.0
// import numpy as np
// x = 0.0
// der_x = 0.1
// A = np.array([[1.0, 2.0, 3.0], [4.0, 5.0, 6.0]])
// k = 2.0
// B = np.array([[2.0, 4.0, 6.0], [8.0, 10.0, 12.0]])
// {
//   "x": np.array(x),
//   "der(x)": np.array(der_x),
//   "B": B,
//   "A": A,
//   "k": np.array(k)
// }
//
// @onnx-test-case
// # Test case 2: A = [[0.5,1.0,1.5],[2.0,2.5,3.0]], k = -1.0
// import numpy as np
// x = 1.0
// der_x = 0.1
// A = np.array([[0.5, 1.0, 1.5], [2.0, 2.5, 3.0]])
// k = -1.0
// B = np.array([[-0.5, -1.0, -1.5], [-2.0, -2.5, -3.0]])
// {
//   "x": np.array(x),
//   "der(x)": np.array(der_x),
//   "B": B,
//   "A": A,
//   "k": np.array(k)
// }
//
// @onnx-test-case
// # Test case 3: A = [[1,1,1],[1,1,1]], k = 0.0
// import numpy as np
// x = 2.0
// der_x = 0.1
// A = np.array([[1.0, 1.0, 1.0], [1.0, 1.0, 1.0]])
// k = 0.0
// B = np.array([[0.0, 0.0, 0.0], [0.0, 0.0, 0.0]])
// {
//   "x": np.array(x),
//   "der(x)": np.array(der_x),
//   "B": B,
//   "A": A,
//   "k": np.array(k)
// }
//
