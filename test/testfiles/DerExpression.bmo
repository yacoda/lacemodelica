//! base 0.1.0
package 'DerExpression'
  model 'DerExpression' "Der applied to expressions (rare 1% case)"
    Real 'x'(start = 1.0);
    Real 'y'(start = 2.0);
    Real 'z';
    Real 'dz_dt';
  equation
    der('x') = -'x';
    der('y') = 'x' - 'y';
    'z' = 'x' * 'y';
    'dz_dt' = der('x' * 'y');
  end 'DerExpression';
end 'DerExpression';

// @onnx-test-reference
// Python reference implementation for ONNX runtime testing
// def reference_implementation(inputs):
//     """
//     Compute expected outputs for DerExpression.
//
//     Equations:
//       der(x) = -x
//       der(y) = x - y
//       z = x * y
//       dz_dt = der(x * y)
//
//     Note: der(x * y) = der(x) * y + x * der(y) by product rule
//     """
//     outputs = {}
//
//     # Extract inputs
//     x = inputs.get('x', 1.0)
//     y = inputs.get('y', 2.0)
//     z = inputs.get('z', 0.0)
//     dz_dt = inputs.get('dz_dt', 0.0)
//     der_x = inputs.get("der('x')", 0.0)
//     der_y = inputs.get("der('y')", 0.0)
//
//     # Compute equation residuals (LHS - RHS = 0)
//
//     # Equation 0: der(x) = -x  =>  der(x) - (-x) = 0
//     eq_0 = der_x - (-x)
//     outputs['eq[0]'] = eq_0
//
//     # Equation 1: der(y) = x - y  =>  der(y) - (x - y) = 0
//     eq_1 = der_y - (x - y)
//     outputs['eq[1]'] = eq_1
//
//     # Equation 2: z = x * y  =>  z - x * y = 0
//     eq_2 = z - x * y
//     outputs['eq[2]'] = eq_2
//
//     # Equation 3: dz_dt = der(x * y)
//     # By product rule: der(x * y) = der(x) * y + x * der(y)
//     # So: dz_dt - (der(x) * y + x * der(y)) = 0
//     eq_3 = dz_dt - (der_x * y + x * der_y)
//     outputs['eq[3]'] = eq_3
//
//     # Start values
//     outputs['start[0]'] = 1.0  # x.start
//     outputs['start[1]'] = 2.0  # y.start
//
//     return outputs
//
// @onnx-test-case
// Test case 1: Initial state values
// {
//   "x": 1.0,
//   "y": 2.0,
//   "z": 2.0,
//   "dz_dt": -3.0,
//   "der('x')": -1.0,
//   "der('y')": -1.0
// }
//
// @onnx-test-case
// Test case 2: Non-initial state with smaller values
// {
//   "x": 0.5,
//   "y": 1.5,
//   "z": 0.75,
//   "dz_dt": -1.25,
//   "der('x')": -0.5,
//   "der('y')": -1.0
// }
//
// @onnx-test-case
// Test case 3: State with larger values
// {
//   "x": 2.0,
//   "y": 3.0,
//   "z": 6.0,
//   "dz_dt": -8.0,
//   "der('x')": -2.0,
//   "der('y')": -1.0
// }
