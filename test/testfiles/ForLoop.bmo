// SPDX-License-Identifier: MIT
// Copyright (c) 2025 Joris Gillis, YACODA

//! base 0.1.0
package 'ForLoop'
  model 'ForLoop' "Test model with for loop in equations"
    parameter Real 'alpha' = 0.5 "Decay coefficient";

    Real 'x'[3](fixed = true, start = 0.0) "State vector";
    Real 'y' "Output";

  equation
    for i in 1:3 loop
      der('x'[i]) = -'alpha' * 'x'[i];
    end for;
    'y' = 'x'[1] + 'x'[2] + 'x'[3];

  end 'ForLoop';
end 'ForLoop';

// @onnx-test-reference
// Python reference implementation for ONNX runtime testing
// def reference_implementation(inputs):
//     import numpy as np
//     outputs = {}
//
//     # Extract inputs
//     x = [inputs['x[1]'], inputs['x[2]'], inputs['x[3]']]
//     y = inputs['y']
//     alpha = inputs['alpha']
//     der_x = inputs["der('x')"]
//
//     # For loop equations: der(x[i]) = -alpha * x[i] for i in 1:3
//     outputs[f'eq[0]'] = np.concat([der_x[i] - (-alpha * x[i]) for i in range(3)])
//
//     # Equation 1: y = x[1] + x[2] + x[3]
//     outputs['eq[1]'] = y - (x[0] + x[1] + x[2])
//
//     # Initial equations
//     outputs['init_eq[0]'] = x[0] - 0.0
//     outputs['init_eq[1]'] = x[1] - 0.0
//     outputs['init_eq[2]'] = x[2] - 0.0
//
//     return outputs
//
// @onnx-test-case
// # Test case 1: Initial conditions
// import numpy as np
// x1 = 0.0
// x2 = 0.0
// x3 = 0.0
// alpha = 0.5
// y = 0.0
// der_x1 = -alpha * x1
// der_x2 = -alpha * x2
// der_x3 = -alpha * x3
// {
//   "x[1]": np.array(x1),
//   "x[2]": np.array(x2),
//   "x[3]": np.array(x3),
//   "y": np.array(y),
//   "alpha": np.array(alpha),
//   "der('x'[1])": np.array(der_x1),
//   "der('x'[2])": np.array(der_x2),
//   "der('x'[3])": np.array(der_x3)
// }
//
// @onnx-test-case
// # Test case 2: Non-zero state
// import numpy as np
// x1 = 1.0
// x2 = 2.0
// x3 = 3.0
// alpha = 0.5
// y = 6.0
// der_x1 = -alpha * x1
// der_x2 = -alpha * x2
// der_x3 = -alpha * x3
// {
//   "x[1]": np.array(x1),
//   "x[2]": np.array(x2),
//   "x[3]": np.array(x3),
//   "y": np.array(y),
//   "alpha": np.array(alpha),
//   "der('x'[1])": np.array(der_x1),
//   "der('x'[2])": np.array(der_x2),
//   "der('x'[3])": np.array(der_x3)
// }
//
// @onnx-test-case
// # Test case 3: Different alpha
// import numpy as np
// x1 = 0.5
// x2 = 1.5
// x3 = 2.5
// alpha = 1.0
// y = 4.5
// der_x1 = -alpha * x1
// der_x2 = -alpha * x2
// der_x3 = -alpha * x3
// {
//   "x[1]": np.array(x1),
//   "x[2]": np.array(x2),
//   "x[3]": np.array(x3),
//   "y": np.array(y),
//   "alpha": np.array(alpha),
//   "der('x'[1])": np.array(der_x1),
//   "der('x'[2])": np.array(der_x2),
//   "der('x'[3])": np.array(der_x3)
// }
//
