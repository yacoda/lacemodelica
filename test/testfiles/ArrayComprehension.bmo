// SPDX-License-Identifier: MIT
// Copyright (c) 2025 Joris Gillis, YACODA

//! base 0.1.0
package 'ArrayComprehension'
  model 'ArrayComprehension' "Test model with array comprehension in expressions"
    parameter Real 'a' = 2.0 "Multiplier";
    parameter Real 'b'[3] "Input array";

    Real 'x'(start = 0.0);
    Real 'y'[3] "Array built from comprehension";
    Real 'z' "Sum of y";

  equation
    der('x') = 0.1;
    // Array comprehension: {expr for i in 1:n}
    'y' = {('a' * 'b'[i]) for i in 1:3};
    'z' = 'y'[1] + 'y'[2] + 'y'[3];

  end 'ArrayComprehension';
end 'ArrayComprehension';

// @onnx-test-reference
// Python reference implementation for ONNX runtime testing
// def reference_implementation(inputs):
//     import numpy as np
//     outputs = {}
//
//     # Extract inputs
//     x = inputs['x']
//     der_x = inputs["der(x)"]
//     a = inputs['a']
//     b = inputs['b']
//     y = inputs['y']
//     z = inputs['z']
//
//     # Equation 0: der(x) = 0.1
//     outputs['eq[0]'] = der_x - 0.1
//
//     # Equation 1: y = {a * b[i] for i in 1:3}
//     # Array comprehension creates array [a*b[0], a*b[1], a*b[2]]
//     y_expected = np.array([a * b[i] for i in range(3)])
//     outputs['eq[1]'] = y - y_expected
//
//     # Equation 2: z = y[1] + y[2] + y[3]
//     outputs['eq[2]'] = z - (y[0] + y[1] + y[2])
//
//     # Initial value
//     outputs['start[0]'] = np.array(0.0)
//
//     return outputs
//
// @onnx-test-case
// # Test case 1: a = 2.0, b = [1.0, 2.0, 3.0]
// import numpy as np
// x = 0.0
// der_x = 0.1
// a = 2.0
// b = np.array([1.0, 2.0, 3.0])
// y = np.array([2.0, 4.0, 6.0])  # a * b
// z = 12.0  # sum of y
// {
//   "x": np.array(x),
//   "der(x)": np.array(der_x),
//   "a": np.array(a),
//   "b": b,
//   "y": y,
//   "z": np.array(z)
// }
//
// @onnx-test-case
// # Test case 2: a = 0.5, b = [2.0, 4.0, 6.0]
// import numpy as np
// x = 1.0
// der_x = 0.1
// a = 0.5
// b = np.array([2.0, 4.0, 6.0])
// y = np.array([1.0, 2.0, 3.0])  # a * b
// z = 6.0  # sum of y
// {
//   "x": np.array(x),
//   "der(x)": np.array(der_x),
//   "a": np.array(a),
//   "b": b,
//   "y": y,
//   "z": np.array(z)
// }
//
// @onnx-test-case
// # Test case 3: a = -1.0, b = [1.0, -2.0, 3.0]
// import numpy as np
// x = 2.0
// der_x = 0.1
// a = -1.0
// b = np.array([1.0, -2.0, 3.0])
// y = np.array([-1.0, 2.0, -3.0])  # a * b
// z = -2.0  # sum of y
// {
//   "x": np.array(x),
//   "der(x)": np.array(der_x),
//   "a": np.array(a),
//   "b": b,
//   "y": y,
//   "z": np.array(z)
// }
//
