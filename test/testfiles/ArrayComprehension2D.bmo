// SPDX-License-Identifier: MIT
// Copyright (c) 2025 Joris Gillis, YACODA

//! base 0.1.0
package 'ArrayComprehension2D'
  model 'ArrayComprehension2D' "Test model with 2D array comprehension (nested for loops)"
    parameter Real 'a' = 2.0 "Multiplier";
    parameter Real 'b'[2] "First input array";
    parameter Real 'c'[3] "Second input array";

    Real 'x'(start = 0.0);
    Real 'M'[2, 3] "Matrix built from nested comprehension";
    Real 'total' "Sum of all elements";

  equation
    der('x') = 0.1;
    // 2D array comprehension: {{expr for j in 1:m} for i in 1:n}
    // M[i,j] = b[i] * c[j]
    'M' = {{'b'[i] * 'c'[j] for j in 1:3} for i in 1:2};
    'total' = 'M'[1,1] + 'M'[1,2] + 'M'[1,3] + 'M'[2,1] + 'M'[2,2] + 'M'[2,3];

  end 'ArrayComprehension2D';
end 'ArrayComprehension2D';

// @onnx-test-reference
// Python reference implementation for ONNX runtime testing
// def reference_implementation(inputs):
//     import numpy as np
//     outputs = {}
//
//     # Extract inputs
//     x = inputs['x']
//     der_x = inputs["der(x)"]
//     a = inputs['a']
//     b = inputs['b']
//     c = inputs['c']
//     M = inputs['M']
//     total = inputs['total']
//
//     # Equation 0: der(x) = 0.1
//     outputs['eq[0]'] = der_x - 0.1
//
//     # Equation 1: M = {{b[i] * c[j] for j in 1:3} for i in 1:2}
//     # Nested array comprehension creates 2D array [2, 3]
//     M_expected = np.array([[b[i] * c[j] for j in range(3)] for i in range(2)])
//     outputs['eq[1]'] = M - M_expected
//
//     # Equation 2: total = sum of all M elements
//     outputs['eq[2]'] = total - np.sum(M)
//
//     # Initial value
//     outputs['start[0]'] = np.array(0.0)
//
//     return outputs
//
// @onnx-test-case
// # Test case 1: b = [1.0, 2.0], c = [1.0, 2.0, 3.0]
// import numpy as np
// x = 0.0
// der_x = 0.1
// a = 2.0
// b = np.array([1.0, 2.0])
// c = np.array([1.0, 2.0, 3.0])
// # M[i,j] = b[i] * c[j]
// # M = [[1*1, 1*2, 1*3], [2*1, 2*2, 2*3]] = [[1, 2, 3], [2, 4, 6]]
// M = np.array([[1.0, 2.0, 3.0], [2.0, 4.0, 6.0]])
// total = 18.0  # 1+2+3+2+4+6
// {
//   "x": np.array(x),
//   "der(x)": np.array(der_x),
//   "a": np.array(a),
//   "b": b,
//   "c": c,
//   "M": M,
//   "total": np.array(total)
// }
//
// @onnx-test-case
// # Test case 2: b = [0.5, 1.5], c = [2.0, 4.0, 6.0]
// import numpy as np
// x = 1.0
// der_x = 0.1
// a = 2.0
// b = np.array([0.5, 1.5])
// c = np.array([2.0, 4.0, 6.0])
// # M[i,j] = b[i] * c[j]
// # M = [[0.5*2, 0.5*4, 0.5*6], [1.5*2, 1.5*4, 1.5*6]] = [[1, 2, 3], [3, 6, 9]]
// M = np.array([[1.0, 2.0, 3.0], [3.0, 6.0, 9.0]])
// total = 24.0  # 1+2+3+3+6+9
// {
//   "x": np.array(x),
//   "der(x)": np.array(der_x),
//   "a": np.array(a),
//   "b": b,
//   "c": c,
//   "M": M,
//   "total": np.array(total)
// }
//
// @onnx-test-case
// # Test case 3: b = [-1.0, 1.0], c = [1.0, -1.0, 1.0]
// import numpy as np
// x = 2.0
// der_x = 0.1
// a = 2.0
// b = np.array([-1.0, 1.0])
// c = np.array([1.0, -1.0, 1.0])
// # M[i,j] = b[i] * c[j]
// # M = [[-1*1, -1*-1, -1*1], [1*1, 1*-1, 1*1]] = [[-1, 1, -1], [1, -1, 1]]
// M = np.array([[-1.0, 1.0, -1.0], [1.0, -1.0, 1.0]])
// total = 0.0  # -1+1-1+1-1+1
// {
//   "x": np.array(x),
//   "der(x)": np.array(der_x),
//   "a": np.array(a),
//   "b": b,
//   "c": c,
//   "M": M,
//   "total": np.array(total)
// }
//
