// SPDX-License-Identifier: MIT
// Copyright (c) 2025 Joris Gillis, YACODA

//! base 0.1.0
package 'AlgorithmForLoopArray'
  // Function with a for loop that builds an output array element by element
  pure function 'scaleArray' "Scale each element of an array"
    input Real 'arr'[3];
    input Real 'factor';
    output Real 'result'[3];
  algorithm
    for i in 1:3 loop
      'result'[i] := 'factor' * 'arr'[i];
    end for;
  end 'scaleArray';

  model 'AlgorithmForLoopArray' "Model using function with array-building for loop"
    parameter Real 'a'[3] = {1.0, 2.0, 3.0};
    parameter Real 'k' = 2.0;
    Real 'x'(start = 0.0);
    Real 'y'[3];
  equation
    der('x') = 0.1;
    'y' = 'scaleArray'('a', 'k');
  end 'AlgorithmForLoopArray';
end 'AlgorithmForLoopArray';

// @onnx-test-reference
// Python reference implementation for ONNX runtime testing
// def reference_implementation(inputs):
//     import numpy as np
//     outputs = {}
//
//     # Extract inputs
//     x = inputs['x']
//     der_x = inputs["der(x)"]
//     y = inputs['y']
//     a = inputs['a']
//     k = inputs['k']
//
//     # Equation 0: der(x) = 0.1
//     outputs['eq[0]'] = der_x - 0.1
//
//     # Equation 1: y = scaleArray(a, k)
//     # The function scales each element: result[i] = factor * arr[i]
//     scaled = np.zeros(3)
//     for i in range(3):
//         scaled[i] = k * a[i]
//     outputs['eq[1]'] = y - scaled
//
//     # Initial value
//     outputs['start[0]'] = np.array(0.0)
//
//     return outputs
//
// @onnx-test-case
// # Test case 1: a = [1.0, 2.0, 3.0], k = 2.0, result = [2.0, 4.0, 6.0]
// import numpy as np
// x = 0.0
// der_x = 0.1
// a = np.array([1.0, 2.0, 3.0])
// k = 2.0
// y = np.array([2.0, 4.0, 6.0])
// {
//   "x": np.array(x),
//   "der(x)": np.array(der_x),
//   "y": y,
//   "a": a,
//   "k": np.array(k)
// }
//
// @onnx-test-case
// # Test case 2: a = [0.5, 1.5, 2.5], k = -1.0, result = [-0.5, -1.5, -2.5]
// import numpy as np
// x = 1.0
// der_x = 0.1
// a = np.array([0.5, 1.5, 2.5])
// k = -1.0
// y = np.array([-0.5, -1.5, -2.5])
// {
//   "x": np.array(x),
//   "der(x)": np.array(der_x),
//   "y": y,
//   "a": a,
//   "k": np.array(k)
// }
//
// @onnx-test-case
// # Test case 3: a = [1.0, 1.0, 1.0], k = 0.5, result = [0.5, 0.5, 0.5]
// import numpy as np
// x = 2.0
// der_x = 0.1
// a = np.array([1.0, 1.0, 1.0])
// k = 0.5
// y = np.array([0.5, 0.5, 0.5])
// {
//   "x": np.array(x),
//   "der(x)": np.array(der_x),
//   "y": y,
//   "a": a,
//   "k": np.array(k)
// }
//
