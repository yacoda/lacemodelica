//! base 0.1.0
package 'NestedIf'
  model 'NestedIf' "Nested conditional expressions"
    Real 'x'(start = 0.0);
    Real 'mode';
    Real 'output';
  equation
    der('x') = 1.0;
    'mode' = if 'x' < 0.3 then 1.0 elseif 'x' < 0.6 then 2.0 elseif 'x' < 0.9 then 3.0 else 4.0;
    'output' = 'mode' * 'x';
  end 'NestedIf';
end 'NestedIf';

// @onnx-test-reference
// Python reference implementation for ONNX runtime testing
// def reference_implementation(inputs):
//     import numpy as np
//     outputs = {}
//
//     # Extract inputs
//     x = inputs['x']
//     der_x = inputs["der(x)"]
//     mode = inputs['mode']
//     output = inputs['output']
//
//     # Equation 0: der(x) = 1.0
//     # Rearranged: der(x) - 1.0 = 0
//     eq_0 = der_x - 1.0
//     outputs['eq[0]'] = np.array(eq_0)
//
//     # Equation 1: mode = if x < 0.3 then 1.0 elseif x < 0.6 then 2.0 elseif x < 0.9 then 3.0 else 4.0
//     # Evaluate nested if-then-else expression
//     if x < 0.3:
//         mode_expected = 1.0
//     elif x < 0.6:
//         mode_expected = 2.0
//     elif x < 0.9:
//         mode_expected = 3.0
//     else:
//         mode_expected = 4.0
//
//     # Rearranged: mode - mode_expected = 0
//     eq_1 = mode - mode_expected
//     outputs['eq[1]'] = np.array(eq_1)
//
//     # Equation 2: output = mode * x
//     # Rearranged: output - mode * x = 0
//     eq_2 = output - mode * x
//     outputs['eq[2]'] = np.array(eq_2)
//
//     # Initial value (start[0] corresponds to x's initial value)
//     outputs['start[0]'] = np.array(0.0)
//
//     return outputs
//
// @onnx-test-case
// # Test case 1: x < 0.3 (first branch, mode = 1.0)
// import numpy as np
// x = np.array(0.15)
// mode = np.array(1.0)
// {
//   "x": x,
//   "der(x)": np.array(1.0),
//   "mode": mode,
//   "output": np.array(mode * x)
// }
//
// @onnx-test-case
// # Test case 2: 0.3 <= x < 0.6 (second branch, mode = 2.0)
// import numpy as np
// x = np.array(0.45)
// mode = np.array(2.0)
// {
//   "x": x,
//   "der(x)": np.array(1.0),
//   "mode": mode,
//   "output": np.array(mode * x)
// }
//
// @onnx-test-case
// # Test case 3: 0.6 <= x < 0.9 (third branch, mode = 3.0)
// import numpy as np
// x = np.array(0.75)
// mode = np.array(3.0)
// {
//   "x": x,
//   "der(x)": np.array(1.0),
//   "mode": mode,
//   "output": np.array(mode * x)
// }
//
// @onnx-test-case
// # Test case 4: x >= 0.9 (else branch, mode = 4.0)
// import numpy as np
// x = np.array(1.2)
// mode = np.array(4.0)
// {
//   "x": x,
//   "der(x)": np.array(1.0),
//   "mode": mode,
//   "output": np.array(mode * x)
// }
//
// @onnx-test-case
// # Test case 5: Boundary case at x = 0.3 (second branch, mode = 2.0)
// import numpy as np
// x = np.array(0.3)
// mode = np.array(2.0)
// {
//   "x": x,
//   "der(x)": np.array(1.0),
//   "mode": mode,
//   "output": np.array(mode * x)
// }
