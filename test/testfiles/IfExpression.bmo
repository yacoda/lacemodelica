//! base 0.1.0
package 'IfExpression'
  model 'IfExpression' "Conditional value with if-expression"
    parameter Real 'threshold' = 0.5;
    Real 'x'(start = 0.0);
    Real 'y';
  initial equation
    'x' = 1.0;
  equation
    der('x') = -0.3 * 'x';
    'y' = if 'x' > 'threshold' then 'x' ^ 2 else 0.5 * 'x';
  end 'IfExpression';
end 'IfExpression';

// @onnx-test-reference
// Python reference implementation for ONNX runtime testing
// def reference_implementation(inputs):
//     import numpy as np
//     outputs = {}
//
//     # Extract inputs (already numpy scalars)
//     threshold = inputs['threshold']
//     x = inputs['x']
//     y = inputs['y']
//     der_x = inputs["der(x)"]
//
//     # Compute equation residuals
//     outputs['eq[0]'] = der_x - (-0.3 * x)
//
//     if_expr_value = x ** 2 if x > threshold else 0.5 * x
//     outputs['eq[1]'] = y - if_expr_value
//
//     # Initial equation
//     outputs['init_eq[0]'] = x - 1.0
//
//     # Initial value
//     outputs['start[0]'] = np.array(1.0)
//
//     return outputs
//
// @onnx-test-case
// # Test case 1: x > threshold (true branch)
// import numpy as np
// threshold = 0.5
// x = 0.8
// y = x ** 2 if x > threshold else 0.5 * x
// der_x = -0.3 * x
// {
//   "threshold": np.array(threshold),
//   "x": np.array(x),
//   "y": np.array(y),
//   "der(x)": np.array(der_x)
// }
//
// @onnx-test-case
// # Test case 2: x <= threshold (false branch)
// import numpy as np
// threshold = 0.5
// x = 0.3
// y = x ** 2 if x > threshold else 0.5 * x
// der_x = -0.3 * x
// {
//   "threshold": np.array(threshold),
//   "x": np.array(x),
//   "y": np.array(y),
//   "der(x)": np.array(der_x)
// }
//
// @onnx-test-case
// # Test case 3: x at boundary (x = threshold)
// import numpy as np
// threshold = 0.5
// x = 0.5
// y = x ** 2 if x > threshold else 0.5 * x
// der_x = -0.3 * x
// {
//   "threshold": np.array(threshold),
//   "x": np.array(x),
//   "y": np.array(y),
//   "der(x)": np.array(der_x)
// }
